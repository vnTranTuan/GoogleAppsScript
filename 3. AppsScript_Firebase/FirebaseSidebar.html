<!-- 
  FirebaseSidebar.html: Giao di·ªán ng∆∞·ªùi d√πng cho Google Apps Script
  S·ª≠ d·ª•ng Tailwind CSS (th√¥ng qua CDN) ƒë·ªÉ t·∫°o giao di·ªán hi·ªán ƒë·∫°i.
-->
<!DOCTYPE html>
<html>
<head>
  <!-- T·∫£i Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* S·ª≠ d·ª•ng font Inter cho th·∫©m m·ªπ */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background-color: #f7f7f7;
    }
    .sidebar-container {
      width: 100%;
      min-width: 250px;
      padding: 1rem;
    }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #f97316; /* M√†u cam/v√†ng c·ªßa Firebase */
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="sidebar-container">

  <!-- Ti√™u ƒë·ªÅ Sidebar -->
  <h1 class="text-2xl font-extrabold text-red-600 mb-2">üî• Firestore Input</h1>
  <p class="text-sm text-gray-600 mb-4 border-b pb-4">
    ƒê·ªçc d·ªØ li·ªáu t·ª´ Sheet (A2:B5) v√† ghi th√†nh b·∫£n ghi m·ªõi.
  </p>

  <!-- Khu v·ª±c th√¥ng b√°o tr·∫°ng th√°i -->
  <div id="status-area" class="p-3 mb-6 rounded-lg text-sm transition-colors duration-300 bg-gray-100 text-gray-700 font-medium border border-gray-300">
    Tr·∫°ng th√°i: S·∫µn s√†ng k·∫øt n·ªëi.
  </div>

  <!-- N√∫t T√°c v·ª• -->
  <div class="space-y-4">
    
    <!-- N√∫t 1: Ghi D·ªØ li·ªáu -->
    <button id="btn-save" 
            class="w-full flex justify-center items-center px-4 py-3 bg-red-600 text-white font-bold rounded-xl shadow-lg hover:bg-red-700 transition duration-150 transform hover:scale-[1.01]"
            onclick="runTask(this, 'saveDataToFirestore')">
      <span class="button-content">
        üíæ Ghi D·ªØ li·ªáu A2:B5 v√†o Firestore
      </span>
    </button>
  </div>

  <!-- Th√¥ng tin tham kh·∫£o -->
  <div class="mt-6 pt-4 border-t text-xs text-gray-500">
    <p>Collection ƒë√≠ch: <code>sheet_input_data</code></p>
    <p>C·ªôt A: Item (stringValue)</p>
    <p>C·ªôt B: Value (doubleValue)</p>
  </div>


  <script>
    // H√†m trung gian qu·∫£n l√Ω tr·∫°ng th√°i n√∫t v√† g·ªçi server
    function runTask(buttonElement, functionName) {
      // 1. L∆∞u n·ªôi dung g·ªëc v√† v√¥ hi·ªáu h√≥a n√∫t
      buttonElement.originalHTML = buttonElement.querySelector('.button-content').innerHTML;
      buttonElement.disabled = true;
      
      // V√¥ hi·ªáu h√≥a hover v√† ƒë·ªïi m√†u sang tr·∫°ng th√°i ch·ªù
      buttonElement.classList.remove('bg-red-600', 'hover:bg-red-700');
      buttonElement.classList.add('bg-gray-400');

      // 2. Th√™m bi·ªÉu t∆∞·ª£ng loading
      buttonElement.querySelector('.button-content').innerHTML = `
        <div class="flex items-center space-x-2">
          <div class="loader"></div>
          <span>ƒêang g·ª≠i d·ªØ li·ªáu...</span>
        </div>
      `;

      // 3. G·ªçi h√†m Apps Script Server-side
      google.script.run
        .withSuccessHandler(showStatus.bind(null, buttonElement))
        .withFailureHandler(showStatus.bind(null, buttonElement))
        [functionName](); 
    }

    // H√†m x·ª≠ l√Ω ph·∫£n h·ªìi t·ª´ server (d√π th√†nh c√¥ng hay th·∫•t b·∫°i)
    function showStatus(buttonElement, message) {
      const statusArea = document.getElementById('status-area');
      let statusMessage;
      let isError = false;

      // 1. LU√îN LU√îN B·∫¨T L·∫†I N√öT V√Ä KH√îI PH·ª§C N·ªòI DUNG (∆Øu ti√™n 1)
      if (buttonElement) {
        buttonElement.disabled = false;
        buttonElement.querySelector('.button-content').innerHTML = buttonElement.originalHTML;
        // Kh√¥i ph·ª•c m√†u s·∫Øc g·ªëc
        buttonElement.classList.remove('bg-gray-400');
        buttonElement.classList.add('bg-red-600', 'hover:bg-red-700');
      }

      // 2. X·ª≠ l√Ω message tr·∫£ v·ªÅ
      if (typeof message === 'object' && message instanceof Error) {
        // X·ª≠ l√Ω l·ªói t·ª´ Server-side (Failure Handler)
        statusMessage = 'L·ªñI: ' + message.message;
        isError = true;
      } else {
        // X·ª≠ l√Ω th√†nh c√¥ng (Success Handler)
        statusMessage = message;
        // Ki·ªÉm tra n·∫øu n·ªôi dung th√†nh c√¥ng v·∫´n ch·ª©a l·ªói (v√≠ d·ª•: l·ªói c·∫•u h√¨nh do ng∆∞·ªùi d√πng t·∫°o)
        if (typeof statusMessage === 'string' && statusMessage.includes('L·ªñI')) {
          isError = true;
        }
      }

      // 3. Hi·ªÉn th·ªã tr·∫°ng th√°i v√† ƒë·ªïi m√†u
      statusArea.textContent = 'Tr·∫°ng th√°i: ' + statusMessage;
      
      // Thay ƒë·ªïi m√†u n·ªÅn d·ª±a tr√™n tr·∫°ng th√°i (Th√†nh c√¥ng/Th·∫•t b·∫°i)
      statusArea.classList.remove('bg-gray-100', 'text-gray-700', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
      
      if (isError) {
        statusArea.classList.add('bg-red-100', 'text-red-700', 'font-semibold');
      } else {
        statusArea.classList.add('bg-green-100', 'text-green-700', 'font-semibold');
      }
    }
  </script>
</body>
</html>